<?php
    //where is close icon? or create?
	require_once( realpath( dirname(__FILE__) . "/../../../wp-includes/wp-db.php" ) );
	require_once( realpath( dirname(__FILE__) . "/../../../wp-blog-header.php"));
	require_once( realpath( dirname(__FILE__) . "/dbconfig.php" ) );
    require_once( realpath( dirname(__FILE__) . "/koramedia.php" ) );

	global $wpdb;
	define('KORA_PLUGIN_RESTFUL_SUBPATH', 'api/restful.php');
    define('KORA_PLUGIN_PATHBASE', plugin_dir_url(__FILE__));
     
	 /* connect to database*/
	 $mysql_hostname = kordat_dbhostname;
     $mysql_user = kordat_dbhostuser;
     $mysql_database = kordat_dbselectname;
	 $mysql_password = kordat_dbhostpass;

	 $projector_id=get_option('kordat_dbproj');
       // var_dump( $projector_id);
   
	 $scheme_id=get_option('kordat_dbscheme');
	 $n=0;
	// var_dump($scheme_id);
	if (is_array($projector_id)) {
	 foreach($projector_id as $value){
		if($value !==""){
			//echo $value;
			$table[$n]="p".$value."Control";
			//echo $table[$n];
			$n=$n+1;
		}
	 }
	}
	
	// $table="p".$projector_id."Control";
     $bd = new mysqli($mysql_hostname, $mysql_user, $mysql_password, $mysql_database);
     if ($bd->connect_error) {
      die("Connection failed: " . $bd->connect_error);
     }
	 

	 
	 $i=0;
	 $query_control='';
	if (is_array($table)) {
	 foreach($table as $value){
		if($i!=0){
			$query_control.= " UNION ALL ";
		}
		
		$query_control .= "SELECT name,schemeid FROM $value WHERE showInResults = 1 AND schemeid in(";
       
		$lastScheme = end($scheme_id);
	  if (is_array($scheme_id)) {	
		foreach($scheme_id as $value){
		 if($value == $lastScheme){
			 $query_control.=$value;  
		 }
		 else{
			 $query_control.=$value.",";
		 }
		 
	   }
	  }
		$query_control.=")";
			$i=$i+1;
	 }
	}

	 $query_control.="  ORDER BY name ASC;";
     //create scheme information query
     $query_scheme .= "SELECT schemeid, pid, schemeName, description FROM scheme WHERE schemeid in(";
     if (is_array($scheme_id)) {	
         $lastScheme = end($scheme_id);
		foreach($scheme_id as $value){
		 if($value == $lastScheme){
             $query_scheme .=$value;
		 }
		 else{
             $query_scheme .= $value.",";
         }
	   }
	  }
     $query_scheme.=")";
     $query_scheme .= " ORDER BY schemeid ASC;";
 //Get all scheme infromation from db.
   $stmt = $bd->prepare($query_scheme) ;
   $stmt->execute();
   $stmt->bind_result($sid, $pid, $sname, $sdesc);
   $schemeInfo = array();
   
   while($stmt->fetch()){  
        $schemeInfo[] = array('sid' => $sid, 'pid' => $pid, 'schemeName' => $sname, 'description' => $sdesc);                     
   }
   //var_dump($schemeInfo);
   $stmt->close(); 
  // var_dump($schemeInfo);
  
	?>


    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

    <script src="<?php echo plugins_url('kora/remodal_v1.0.6/dist/remodal.min.js'); ?>"></script>
    <script src="<?php echo plugins_url('kora/chosen_v1.4.2/chosen.jquery.min.js'); ?>"></script>
    <script src="<?php echo plugins_url('kora/chosen_v1.4.2/chosen.proto.min.js'); ?>"></script>
    <script> var url_plugin = '<?php echo KORA_PLUGIN_PATHBASE;?>'; 
             var schemeid = "<?php if (isset($_POST['kid'])) { echo $_POST['kid']; } ?>";
    </script>
    <?php $libraryUrl = admin_url('admin.php?page=Library'); ?>
    <script>
        var libraryUrl = "<?php echo $libraryUrl;?>";
     </script>
    
    <script src="<?php echo plugins_url('kora/addkoraobject.js'); ?>"></script>
	
    <link rel="stylesheet" href="<?php echo plugins_url('kora/remodal_v1.0.6/dist/remodal.css'); ?>" type="text/css"/>
    <link rel="stylesheet" href="<?php echo plugins_url('kora/remodal_v1.0.6/dist/remodal-default-theme.css'); ?>" type="text/css"/>
    <link rel="stylesheet" href="<?php echo plugins_url('kora/chosen_v1.4.2/chosen.css'); ?>" type="text/css"/>



    <div class='wrap' id="addNewObject">
        <h1>Add New Object(s)</h1>

        <p>Adding a new object(s) will add it to your library. Select a Scheme for the new object(s) to get started.</p>

        <form action="" method="post">
            <select id='newObjectScheme' name="kid" data-placeholder="Scheme: Search and select scheme for new object(s)">
                <option value="default"></option>
				<?php 
                      	foreach ($schemeInfo as $value) {
                            $id_scheme = $value['sid'];
                            $name_scheme = $value['schemeName'];
                            $desc_scheme = $value['description'];
                            $pid_scheme = $value['pid'];
                                echo '<option value="' . $id_scheme . '"' . ($_POST['newObjectScheme'] == $id_scheme ? ' selected="selected"' : '') . '>' . $pid_scheme.'---'.$id_scheme.'---'.$name_scheme.'---'.$desc_scheme.'</option>';
                        }
                ?>
          </select>
            <select id='newObjectFields' class = 'newObjectFields' name = "controlsImage" data-placeholder="Select Image Field Name">
               <option value="default"></option>
           </select>
           <select id='newObjectFields' class = 'newObjectFields' name = "controlsVideo" data-placeholder="Select Video Field Name">
               <option value="default"></option>
           </select>
           <select id='newObjectFields' class = 'newObjectFields' name = "controlsAudio" data-placeholder="Select Audio Field Name">
               <option value="default"></option>
           </select>
            <select id='newObjectFields' class = 'newObjectFields' name = "controlsName[]" data-placeholder="Field(s): Search and select field(s) for new object(s)" multiple>
                <option value="default"></option>

        <?php /*<option value="1">Title</option>
				<option value="2">Date</option>
                <option value="3">Author</option>
                <option value="4">Tags</option>
				<option value="5">Images</option>
				<option value="6">Notes</option> */?>
            </select>
           
            <input type="search" id='searchObjects' name = 'keyword' placeholder="Search Objects" />
            <select id='objectsPerPage' name = 'objectsPerPage'>
                <option value="10" default <?php   if ($_POST['objectsPerPage'] == 10) { echo selected; } ?> >10 Objects Per Page</option>
                <option value="20" <?php   if ($_POST['objectsPerPage'] == 20) { echo selected; } ?> >20 Objects Per Page</option>
                <option value="30" <?php   if ($_POST['objectsPerPage'] == 30) { echo selected; } ?> >40 Objects Per Page</option>
                <option value="80" <?php   if ($_POST['objectsPerPage'] == 80) { echo selected; } ?> >80 Objects Per Page</option>
            </select>
            <button type="submit" name="k_search" id="lib_k_search" class='blue-btn' style = "height:54px; width:302px">Search</button>
            

        </form>
        
   

<?php 
        /* connect to database*/
    $mysql_hostname = kordat_dbhostname;
    $mysql_user = kordat_dbhostuser;
    $mysql_database = kordat_dbselectname;
    $mysql_password = kordat_dbhostpass;

    @$bd = new mysqli($mysql_hostname, $mysql_user, $mysql_password, $mysql_database);
    if ($bd->connect_error) {
        echo "<p class='error'><strong>";
        echo "Please edit config.php.dist (Kora Host Database Settings) first! Save as config.php!";
        echo "</strong></p>";
    } else {
              if ($_SERVER['REQUEST_METHOD'] == 'POST'){
  ?>

     <div class='kora-objs' id = 'kora-objs'>   
                      
    <?php
                if (isset($_POST['kid']) && isset($_POST['controlsName']) && (isset($_POST['controlsImage']) || isset($_POST['controlsVideo']) || isset($_POST['controlsAudio']))) {
                    //get search information
                    $schemeid = $_POST['kid'];
                    $controls = $_POST['controlsName'];
                    $dbproj = get_option('kordat_dbproj');
                    $dbscheme = get_option('kordat_dbscheme');
                    $dbtoken = get_option('kordat_dbtoken');
                   // var_dump($controls);
                    
                    $query_sid_pid = "SELECT schemeid,pid FROM scheme WHERE schemeid = '".$schemeid."';";
                    $stmt = $bd->prepare($query_sid_pid) ;
                    $stmt->execute();
                    $stmt->bind_result($sids,$pids);
                    //$sid_pid_token = array();
                        
                    while($stmt->fetch()){
                        $sid = $sids;
                        $pid = $pids;
                        //echo $sid." ".$pid."<br>";
                        if (in_array($sid, $dbscheme) && in_array($pid, $dbproj)){
                            $pos = array_search($pid, $dbproj);
                            $sid_pid_token = array('schemeid' => $sid, 'projectid' => $pid, 'token' => $dbtoken[$pos]);
                           // $val = $sid."-".$pid."-".$dbtoken[$pos];
                            //array_push($sid_pid_token,$val);
                        }
                    }
                    $stmt->close();
                   // var_dump($sid_pid_token);
                    
                    //korasearch
                    
                    $restful = get_option('kordat_dbapi');
			        $restful_url =$restful . KORA_PLUGIN_RESTFUL_SUBPATH;
			       
                    //GET image/video/audio filed name 
                    
                    $image_control = $_POST['controlsImage'];
                    $video_control = $_POST['controlsVideo'];
                    $audio_control = $_POST['controlsAudio'];
                    
                   // var_dump($image_control);
			                   
			        $i = 0;
			        $fields = "";
			       //$num_option = count($controls);
                 /*   foreach($controls as $option_value) {
                         $fields .= $option_value.',';
                   }
                   if (!in_array("Thumbnail", $controls)) {
                         $fields .= "Thumbnail,";
                    }
                    if (!in_array("Multi-Part Associator", $controls)) {
                         $fields .= "Multi-Part Associator,";
                    }
                    if (!in_array("Image", $controls)) {
                         $fields .= "Image,";
                    }
                    if (!in_array("Audio File", $controls)) {
                         $fields .= "Audio File,";
                    }
                    if (!in_array("Video File", $controls)) {
                         $fields .= "Video File,";
                    }
                    $lastC = substr($fields, -1);
                    if ($lastC == ',') {
                         $fields = trim($fields, ",");
                    } 
                                //var_dump($fields);*/
                    $fields = 'ALL';
                               // $display='plugin';
                    $display = 'json';
                    $query = "";
                    if (isset($_POST['keyword'])) {
                        $k = $_POST['keyword'];
                        if (count($controls) == 1) {
                                $query .= $controls[0].",LIKE,".$k;
                         } else {
                                for ($i = 0; $i < count($controls); $i++) {
                                        if ($i == 0) {
                                            $query .= "(".$controls[$i].",LIKE,".$k.")";
                                        } else {

                                            $query .= ",OR,"."(".$controls[$i].",LIKE,".$k.")";
                                        }
                                }
                         }
                        if (!empty($sid_pid_token)) {
                            $url = $restful_url.'?request=GET&pid='.$sid_pid_token['projectid'].'&sid='.$sid_pid_token['schemeid'].'&token='.$sid_pid_token['token'].'&display='.urlencode($display).'&fields='.urlencode($fields).'&query='.urlencode($query);
                        }
                    
                    } else {
			                    
                        if (!empty($sid_pid_token)) {
                             $url = $restful_url.'?request=GET&pid='.$sid_pid_token['projectid'].'&sid='.$sid_pid_token['schemeid'].'&token='.$sid_pid_token['token'].'&display='.urlencode($display).'&fields='.urlencode($fields);
                        }
                    }
            //   var_dump($url);
                    //initialize post request to KORA API using curl
                    $ch = curl_init($url);
                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
                    curl_setopt($ch, CURLOPT_USERPWD, $user.':'.$pass);

                    //capture results and display
                    $obj_json = curl_exec($ch);
                    //convert json string to php array
                    $server_output = json_decode($obj_json, true);
                   //  var_dump($server_output);   
        if (is_array($server_output)) {
                     
               $total_obj = count($server_output);
              
               $objectsPerPage = $_POST['objectsPerPage'];
               $totalPages = ceil($total_obj / $objectsPerPage); 
            
               ?>
               <button id="selectAll" align="center" class = "blue-btn" style = "height:54px; width: 500px; margin-right: 50px">Select All <?Php echo $total_obj; ?> Objects</button>
               <button id="prevPage" align="center" class = "prev" style = "height:54px; width: 300px; color:white; background-color: #57abce; border: 1px solid #57abce;margin-right: 50px">PREV</button>
               
               <button id="nextPage" align="center" class = "next" style = "height:54px; width: 300px; color:white; background-color: #57abce; border: 1px solid #57abce">NEXT</button>
               <div id="pagination"  alt = "<?php echo $total_obj; ?>">
                 <?php   /*<a href="#" class="prev" >
                    <img id="prevPage" src="../wp-content/plugins/kora/images/Arrow%20-%20Pagination%20Left.svg" 
                        width="8" height="15" alt="Previous Page Arrow"  style = "display:inline"/>
                    </a>
                    
                    <div id="pageNums" alt = "<?php echo $totalPages; ?>">
                        <input type = 'text' name = 'curPageNum' >
                        <?php 
                            for ($i = 1; $i <= $totalPages; $i++) {
                                 echo '<span id = "pagenum_'.$i.'" >'.$i.'</span>';
                            }
                            
                            // <span class="active-page">1</span>
                       // <span>2</span>
                        //<span>3</span>
                    
                       // <span>...</span>
                     //   <span>20</span>
                            
                        ?>
                       
                    </div>
                    <a href="#" class="next">
                    <img id="nextPage" src="../wp-content/plugins/kora/images/Arrow%20-%20Pagination%20Right.svg" 
                        width="8" height="15" alt="Next Page Arrow" />
                     </a>*/ ?>
                </div>  
                    
                       
               <?php
               $media_type = "";
               echo " <span id = 'image_control' style = 'display:none'>".$image_control."</span>
                      <span id = 'video_control' style = 'display:none'>".$video_control."</span>
                      <span id = 'audio_control' style = 'display:none'>".$audio_control."</span>";
               
                     foreach($server_output as $record) {

                         if ($record[$image_control]) {
                             $thumb_src = get_option('kordat_dbapi').'files/'.$sid_pid_token['projectid'].'/'.$sid_pid_token['schemeid'].'/thumbs/'.$record[$image_control]['localName'];
                             $media_type = "image";
                         } else if ($record[$video_control]) {
                             $videoFile = mysql_escape_string(get_option('kordat_dbapi').'files/'.$sid_pid_token['projectid'].'/'.$sid_pid_token['schemeid']."/".$record['Video File']['localName']);
                            //var_dump($videoFile);
                             $media_type = "video";
                             
                         } else if ($record[$audio_control]) {
                             $audioFile = mysql_escape_string(get_option('kordat_dbapi').'files/'.$sid_pid_token['projectid'].'/'.$sid_pid_token['schemeid']."/".$record['Audio File']['localName']);
                            // var_dump($audioFile);
                             $media_type = "audio";
                         } else {
                             $thumb_src = "http://img.photobucket.com/albums/v516/MizGrace/babyhedgehoginbubblebath.jpg";
                             $media_type = "NULL";
                         }
                         
                         
                         
                                  /* if($record['Image'] || $record['Thumbnail'] ) {
                                       if ($record['Image']) {
                                            $src = get_option('kordat_dbapi').'files/'.$sid_pid_token['projectid'].'/'.$sid_pid_token['schemeid'].'/thumbs/'.$record['Image']['localName'];
                                       } else if ($record['Thumbnail']['localName']) {
                                           $src = get_option('kordat_dbapi').'files/'.$sid_pid_token['projectid'].'/'.$sid_pid_token['schemeid'].'/thumbs/'.$record['Thumbnail']['localName'];

                                          // $src = getThumbnailKORA($record['Thumbnail']['localName']);
                                       }
                                      
                                   } else if ($record['Audio File'] || $record['Video File']) {
                                       if(!empty($record['Audio File']))
                                        {
                                          /*  $audioFile = mysql_escape_string(getFullURLFromFileName($value['Audio File']['localName']));
                                            echo "<br />click play for full interview";
                                        // KoraEmbedMedia(array('kid' => $value['kid'], 'cid' => '28', 'tagid' => 'player', 'width' => '300px', 'height' => '30px', 'autoplay' => 'false'));    
                                            KoraEmbedMedia( Array('url' => $audioFile, 'tagid' => 'player', 'width' => '300px', 'height' => '30px',  'autoplay' => 'false') );      */    
                                  //      } else if(!empty($record['Video File']))
                                  //      {
                                            /*$videoFile = mysql_escape_string(getFullURLFromFileName($value['Video File']['localName']));
                                            if ($value['Start Time'] != "") {
                                                $ts = timetoseconds($value['Start Time']);
                                                $te = timetoseconds($value['End Time']);
                                            } else {
                                                $ts = null;
                                                $te = null;
                                            }
                                            $dur = $te - $ts;
                                        // echo $dur;
                                            // SANITY CHECK TO SEE IF WE HAVE VALID NUMBERS FOR TS/TE/DUR, WORRIED FOR THE CASE IF KORA SETS TO EMPTY
                                            if (!is_numeric($ts) || !is_numeric($dur))
                                            { $ts = -1; $te = -1; $dur = -1; }

                                            echo "<br />click play for full interview";
                                            
                                        KoraEmbedMedia( Array('url' => $videoFile, 'tagid' => 'player', 'width' => '300px', 'height' => '211px', 'timestart' => $ts, 'duration' => $dur, 'autoplay' => 'false') );
                                        // KoraEmbedMedia(array('kid' => $value['kid'], 'cid' => 27, 'tagid' => 'player', 'width' => '300px', 'height' => '211px', 'timestart' => $ts, 'duration' => $dur, 'autoplay' => 'false'));    */
                                   //     }   
                                 //  } 
                                 //  else {
                                 //      $src = "http://img.photobucket.com/albums/v516/MizGrace/babyhedgehoginbubblebath.jpg";
                                 //  }*/
        ?>		
		
		<!-- Same as Library page -->

            <?php  /*
		<!--32-131-1-->
			<div class='kora-obj'>
				<div class='kora-obj-left'>
					<img src='http://orig00.deviantart.net/f0ce/f/2011/027/d/5/darth_vader_by_steveargyle-d387h22.jpg' alt='32-131-1'>
					<input type='button' value='edit details' />
				</div>
				<div class='kora-obj-right'>
					<div class='kora-obj-close'>
						<img src='../wp-content/plugins/kora/images/Close - Tiny.svg' class='closePic'>
					</div>
					<ul class='kora-obj-fields'>
						<li><span>KID:</span> 32-131-1</li> 
						<li><span>Field Name:</span> Field Input</li>
						<li><span>Field Name:</span> Field Input</li>
						<li><span>Field Name:</span> Field Input</li>
						<li><span>Field Name:</span> Field Input. Lorem ipsum dolor sit amet, consectetur adipiscing elit, </li>
						<li><span>Field Name:</span> Field Input</li>
					</ul>
				</div>
			</div>
		*/ ?>
            <?php 
                echo "<div class='kora-obj' id = '".$record['kid']."'>
				                            <div class='kora-obj-left'>";
                                            if($media_type == "image") {
                                                echo "<img src='".$thumb_src."' alt='".$record['kid']."'>";
                                            } else if ($media_type == "video") {
                                                 KoraEmbedMedia( Array('url' => $videoFile, 'tagid' => 'player'.$record['kid'], 'width' => '100%', 'height' => '100%',  'autoplay' => 'false') ); 
                                            } else if ($media_type == "audio") {
                                                 KoraEmbedMedia( Array('url' => $audioFile, 'tagid' => 'player'.$record['kid'], 'width' => '100%', 'height' => '100%',  'autoplay' => 'false') ); 
                                            } else {
                                                echo "<img src='".$thumb_src."' alt='".$record['kid']."'>";
                                            }
  					                          
					                         echo  "<input type='button' class = 'edit_detials' id = '".$record['kid']."' value='edit details'  alt = '".$sid_pid_token['schemeid']."'>
				                            </div>
				                            <div class='kora-obj-right'>
					                          
					                            <ul class='kora-obj-fields'>";
                                                echo '<div id = "edit_details_'.$record['kid'].'">';
						                        echo   "<li><span>KID</span>:".$record['kid']."</li>";
                                                     foreach($controls as $field) {
                                                         if (is_array($record[$field])) {
                                                              echo "<li><span>".$field."</span>: ".implode(" ",$record[$field])."</li>";
                                                         } else {
                                                             echo "<li><span>".$field."</span>: ".$record[$field]."</li>";
                                                         }
                                                     }
						                            //<li><span>Field Name:</span> Field Input</li>
                                                    echo '</div>';
					                            echo "</ul>
				                           </div>
			   </div>";  
                     }
               
                   } else {
                        echo "<h1>No matched object records!</h1>";
                   }
                              
                 } else {
                     echo "<h1>Please choosing Scheme and Controls first!</h1>";
                }
             ?>


               		<div id='add-kora-objs'>
			            <input type="submit" value='Add Object(s) to Library' />
		           </div>

    </div>	
<?Php 
              }
     }  
?>

		




<!-- Modals -->
<div class="remodal" id="deleteObjectModal" data-remodal-id="deleteObjectModal">
	<button data-remodal-action="close" class="remodal-close"></button>

	<h2>Remove this Object?</h2>
	<p>Doing so will remove this object from any gallery it is associated with.</p>

	<button class="remove">Remove</button>
	<button class="cancel">Cancel</button>
</div>


<div class="remodal" id="editObjectModal" data-remodal-id="editObjectModal">
	<button data-remodal-action="close" class="remodal-close"></button>

    <img id="backArrow" src="../wp-content/plugins/kora/images/Arrow%20-%20Left.svg" width="12" height="20" alt="Back Arrow" />
	<h2>Edit Details for Object Name</h2>
    <div class = "object_details">

    </div>
</div>

               		<!-- Similar to Library page -->

<?php 

?>

<script>
    var kid = "<?php echo $kid;?>";
    var pathbase = "<?php echo KORA_PLUGIN_PATHBASE;?>";
</script>


<script>
    jQuery(document).ready(function($){
      
       // check if scheme drop list is selected
        $('#newObjectScheme').change(function(){
            var schemeid = $(this).val();
            //alert(schemeid); 
              $.ajax({
                     type: "GET",
                     async: false,
                     url: pathbase  + "ajaxControls.php",
                     data: {"sid" : schemeid },
                     success: function(data){	
                        // alert(pathbase);
                         $('.newObjectFields').html(data);  
                         $('.newObjectFields').trigger("chosen:updated");      
                
                     }
               });  
        });


       
 // pagination part     
  var e = document.getElementById("objectsPerPage"); 
  var nb = e.options[e.selectedIndex].value;         
  /*var nb = 10;
   if (perpage > 0) {
        nb = perpage;
    }*/
    
    var start = 0;

    var end = start + nb;
    var length = $('.kora-objs .kora-obj').length;
    var list = $('.kora-objs .kora-obj');
    
    list.hide().filter(':lt('+(end)+')').show();
    
    var currentPage = 1;
    $('.prev, .next').click(function(e){
       e.preventDefault();
       console.log(start);
       if( $(this).hasClass('prev') ){
           start -= nb;
      /*     if (currentPage - 1 > 0) {
               currentPage = currentPage - 1;
           }*/
       } else {
           start += nb;
       }
        if (start < 0 ) {
            start = 0;
        } 
        if (start >= length) {
            if (length % nb ==0) {
                 start = length - nb;
            } else {
                 start = length - (length % nb);
            }
           
        }
      // if( start < 0 || start >= length ) start = 0;
       end = start + nb;        
       console.log(start);
       console.log(end);
       
       if( start == 0 ) list.hide().filter(':lt('+(end)+')').show();
       else list.hide().filter(':lt('+(end)+'):gt('+(start-1)+')').show();
    });
        //when insert button is clicked
      /*   $('#add-kora-objs').click(function() {
            alert("11111");
           var checks = $('input[name="checked[]"]:checked');
            var c_true=0;
            var c_false=0;
            //case that you are not checking any checkbox

            if(checks.length == 0){
                window.alert("No Objects Selected!");
            }

            $(checks).each(function(){
                //TODO: What to do with the checked objects
                var chk = $(this).attr('id');

                $.ajax({
                    type: "GET",
                    url: pathbase+"/ajax/insert_library.php",
                    data: {"chk" : chk },
                    async: false,
                    success: function(data){
                        if(data=="true"){
                            c_true++;
                        }else if(data=="false"){
                            c_false++;
                        }
                    }
                });
            });
            if (c_true>0 && c_false>0){
                alert("Some objects were in the library, others were inserted");
            }else if(c_true>0 && c_false==0){
                alert("Objects were inserted successfully");
            }else if(c_true==0 && c_false>0){
                alert("Objects are already in the library");
            }
        });*/
 /*       
                 
	$('#add-kora-objs').click(function() {
		var c_true=0;
		var c_false=0;
		//If no objects are checked
		if(divs.length == 0){
			window.alert("No Objects Selected!");
		}
		//When objects have been checked
		$(divs).each(function(){
			var chk = $(this).attr('id');
			$.ajax({
				type: "GET",
				url: plugin_dir_url+"ajax/insert_library.php",
				data: {"chk": chk},
				async: false,
				success: function(data){
					var target = document.getElementById('loading')
					var spinner = new Spinner(opts).spin(target);
					if(data==false){
						//alert("Object is already in the library");
						parent.location.reload();

					}else{
						alert(data.url);
						var obj = "<div class=\"lib_obj\"><span class='close_lib'>&times;</span><div class='lib_image'><a class = 'popupImage' href = '+data.url+'><img src="+data.url+" alt="+data.KID+"></a></div><div class='lib_title'>"+data.title+"</div></div>";
						$("#wpbody-content").append(obj);
					    parent.location.reload();
					}
					$('.koraobj_container').hide();
				},
				dataType:"json"
			});	
		});
	});
       */

                 
         // check if any control field is selected
     /*    $('#newObjectFields').change(function(){
             //alert('changed');
             var controlSelected = $('#newObjectFields').val();
             var schemeid = $('#newObjectScheme').val();
             //alert(controlSelected);
             if ($('#newObjectFields').has('option').length > 0 ) {
                $.ajax({
                     type: "GET",
                     async: false,
                     url: pathbase  + "ajax/ajaxSearch.php",
                     data: {"controls" : controlSelected, "sid" : schemeid},
                     success: function(data){	
                        // alert(pathbase);
                         $('.kora-objs').html(data);  
                       //  $('#newObjectFields').trigger("chosen:updated");      
                
                     }
               });  
             }
         });     */   
    });
</script>
