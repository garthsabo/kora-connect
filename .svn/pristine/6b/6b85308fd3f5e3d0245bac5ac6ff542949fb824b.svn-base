// var chk;
// var query = '';
// var divs = [];

var pdivs = $(".koraobejct_container_parent");
var num_obj = pdivs.children().size();
if (num_obj > 0) {
  $('.pagination_hearder').prepend("<br><br><span>GET " + "<strong>" + num_obj + "</strong>" + " Records" + "&nbsp&nbsp<button id = 'prev' ><strong>Prev</strong></button>  &nbsp <button id = 'next' ><strong>Next</strong></button>" + "</span>");
  var pos = 0;
  var pagesize = 10;
  if (pos == 0) {
    for (var i = 0; i < pos + pagesize; i++) {
      $(pdivs).children().eq(i).show();

    }
    for (var i = pos + pagesize; i < num_obj; i++) {
      $(pdivs).children().eq(i).hide();

    }
  }
  $('#prev').click(function() {
    if (pos >= 0 + pagesize) {
      var hide_end = pos + pagesize;
      for (var i = pos; i < hide_end; i++) {
        $(pdivs).children().eq(i).hide();
      }
      pos = pos - pagesize;
      var show_end = pos + pagesize;
      for (var i = pos; i < show_end; i++) {
        $(pdivs).children().eq(i).show();
      }
    }
  });
  $('#next').click(function() {
    if (pos < num_obj - pagesize) {
      var hide_end = pos + pagesize;
      for (var i = pos; i < hide_end; i++) {
        $(pdivs).children().eq(i).hide();
      }
      pos += pagesize;
      var show_end = hide_end + pagesize;
      for (var i = pos; i < show_end; i++) {
        $(pdivs).children().eq(i).show();
      }
    }
  });
}

// //search process bar
// $('#submit_serach').click(function() {
//   if (!$('#select_all_scheme').is(':checked')) {
//     // add loading image to div
//     $('#loading').html('<img src="http://preloaders.net/preloaders/287/Filling%20broken%20ring.gif"> loading...');
//     // run ajax request
//     $.ajax({
//       //type: "GET",
//       // dataType: "json",
//       // url: "https://api.github.com/users/jveldboom",
//       success: function(d) {
//         // replace div's content with returned data
//         // $('#loading').html('<img src="'+d.avatar_url+'"><br>'+d.login);
//         // setTimeout added to show loading
//         setTimeout(function() {
//           // $('#loading').html('<img src="' + d.avatar_url + '"><br>' + d.login);
//         }, 2000);
//       }
//     });
//   }
// });

var koraObjectCount = $('.kora-obj').length; // number of kora objects in search
var selectedCount = 0;
var select_all_search = $('#select_all_search');
var select_all_scheme = $('#select_all_scheme');

var insertShortcodeButton = function() {
	if (selectedCount == 0) {
		$('#selected-kora-objs > input').val('');
		$('#selected-kora-objs').removeClass('slide-selected-objs');
	}
	else {
		$('#selected-kora-objs > input').val(selectedCount + ' object(s) selected // add new object(s)?');
		$('#selected-kora-objs').addClass('slide-selected-objs');
	}
}

$('.kora-obj').click(function() {
	$(this).toggleClass('kora-obj-active');
	if($(this).hasClass('kora-obj-active')) {
		selectedCount++;
		if (selectedCount === koraObjectCount) {
			select_all_search.prop('checked', true);
		}
	}
	else {
		selectedCount--;
		if (selectedCount === 0) {
			select_all_search.prop('checked', false);
		}
	}
	insertShortcodeButton();
});

select_all_search.change(function() {
	if(select_all_search.is(':checked')) {
		$('.kora-obj').addClass('kora-obj-active');
		selectedCount = koraObjectCount;
	}
	else {
		$('.kora-obj').removeClass('kora-obj-active');
		selectedCount = 0;
	}
	insertShortcodeButton();
});

$('#insert_shortcode_new').click(function(){
	// if ($('#select_all_scheme').is(':checked')) {
  //   var first = $(divs).first();
  //   chk = "ALL";
  //   $.ajax({
  //     type: "GET",
  //     async: false,
  //     url: url_plugin + "/ajax/insert_library.php",
  //     cache: false,
  //     data: {
  //       "chk": chk
  //     },
  //     success: function(data) {
	//
  //     }
  //   });
  //   chk = first.attr('id');
  //   chk += "-ALL";
  //   query += "(kid,!=," + chk + ")";
  // } else {
  //   $(divs).each(function() {
  //     chk = $(this).attr('id');
  //     $.ajax({
  //       type: "GET",
  //       async: false,
  //       url: url_plugin + "/ajax/insert_library.php",
  //       cache: false,
  //       data: {
  //         "chk": chk
  //       },
  //       success: function(data) {
	//
  //       }
  //     });
	//
  //     if (i == 0 && divs.length == 1 && type == "image") {
  //       query = chk;
  //     } else if (i == 0 && divs.length == 1) {
  //       query = chk;
  //     } else if (divs.length > 1 && i == 0) {
  //       query = "(kid,=," + chk + ")";
  //       i++;
  //     } else if (divs.length > 1 && i < divs.length) {
  //       query += ",or,(kid,=," + chk + ")";
  //       i++;
  //     }
  //   });
  // }
  // var sid = $('#id_scheme option:selected').val();
  // //var field = "";
  // var controlsOnly = controls.substring(1, controls.length - 1);
  // //var controlArray = controlsOnly.split(",");
  // /*for (var i=0; i < controlArray.length; i++) {
  //    fields += controlArray[i];
  // }*/
  // var field = controlsOnly;
  // desc = controlsOnly;
  // //var fields = fields.replace(/"/g,'');
		var title_control = document.getElementById("title_control").value;
		var desc_control = document.getElementById("desc_control").value;
		var img_control = document.getElementById("img_control").value;
		var audio_control = document.getElementById("audio_control").value;
		var video_control = document.getElementById("video_control").value;
		var type = jQuery("input[name='type']:checked").val(); // pagination or infscroll
		var pagesize = 5;
		if ($('#pic_pagesize').val() != '') {
			pagesize = $('#pic_pagesize').val();
		}
		var i = 0;
		var num_selected = $('.kora-obj-active').length;
		var query;
		$('.kora-obj-active').each(function() {
		  var chk = $(this).attr('id'); // kora objects should have KID as their id attribute
		  if (i == 0 && num_selected == 1 && type == "image") {
				// Type = 'image' will never occur. Type would be 'pagination' or 'scroll'.
				// What should be done with this?
		    query = chk;
		  }
			else if (i == 0 && num_selected == 1) {
		    query = "kid,=," + chk;
		  }
			else if (num_selected > 1 && i == 0) {
		    query = "(kid,=," + chk + ")";
		    i++;
		  }
			else if (num_selected > 1 && i < num_selected) {
		    query += ",or,(kid,=," + chk + ")";
		    i++;
		  };
		});
		if ($('#add_details').is(':checked')) {
			var shortcode =
					"[KORAGALLERY KG_TYPE= '" + type +
    			"' KG_IMAGECONTROL= '" + img_control +
    			"' KG_AUDIOCONTROL= '" + audio_control +
    			"' KG_VIDEOCONTROL= '" + video_control +
    			"' KG_TITLECONTROL= '" + title_control +
    			"' KG_DESCCONTROL= '" + desc_control +
    			"' KG_LINKBASE='" + detailslink + //detailslink is declared at end of postlibrary.php
    			"' KGIS_PAGESIZE='" + pagesize +
    			"' QUERY= '" + query +
    			"'][/KORAGALLERY]";
		}
		else {
			var shortcode =
				"[KORAGALLERY KG_TYPE= '" + type +
				"' KG_IMAGECONTROL= '" + img_control +
				"' KG_AUDIOCONTROL= '" + audio_control +
				"' KG_VIDEOCONTROL= '" + video_control +
				"' KG_TITLECONTROL= '" + title_control +
				"' KG_DESCCONTROL= '" + desc_control +
				"' KGIS_PAGESIZE='" + pagesize +
				"' QUERY= '" + query +
				"'][/KORAGALLERY]";
		}

		var win = window.dialogArguments || opener || parent || top;
		win.send_to_editor(shortcode);
});
